// Copyright 2025 The GoGPU Authors
// SPDX-License-Identifier: MIT

//go:build windows

package d3d12

import "fmt"

// HRESULTError represents a Windows HRESULT error code.
type HRESULTError int32

// Error implements the error interface.
func (hr HRESULTError) Error() string {
	if name, ok := hresultNames[hr]; ok {
		return fmt.Sprintf("HRESULT 0x%08X: %s", uint32(hr), name)
	}
	return fmt.Sprintf("HRESULT 0x%08X", uint32(hr))
}

// Code returns the raw HRESULT value.
func (hr HRESULTError) Code() int32 {
	return int32(hr)
}

// Succeeded returns true if the HRESULT indicates success (S_OK or S_FALSE).
func Succeeded(hr int32) bool {
	return hr >= 0
}

// Failed returns true if the HRESULT indicates failure.
func Failed(hr int32) bool {
	return hr < 0
}

// Common HRESULT values.
const (
	S_OK    = HRESULTError(0)
	S_FALSE = HRESULTError(1)

	// Generic errors
	E_UNEXPECTED   = HRESULTError(-2147418113) // 0x8000FFFF
	E_NOTIMPL      = HRESULTError(-2147467263) // 0x80004001
	E_OUTOFMEMORY  = HRESULTError(-2147024882) // 0x8007000E
	E_INVALIDARG   = HRESULTError(-2147024809) // 0x80070057
	E_NOINTERFACE  = HRESULTError(-2147467262) // 0x80004002
	E_POINTER      = HRESULTError(-2147467261) // 0x80004003
	E_HANDLE       = HRESULTError(-2147024890) // 0x80070006
	E_ABORT        = HRESULTError(-2147467260) // 0x80004004
	E_FAIL         = HRESULTError(-2147467259) // 0x80004005
	E_ACCESSDENIED = HRESULTError(-2147024891) // 0x80070005

	// DXGI errors
	DXGI_ERROR_INVALID_CALL                 = HRESULTError(-2005270527) // 0x887A0001
	DXGI_ERROR_NOT_FOUND                    = HRESULTError(-2005270526) // 0x887A0002
	DXGI_ERROR_MORE_DATA                    = HRESULTError(-2005270525) // 0x887A0003
	DXGI_ERROR_UNSUPPORTED                  = HRESULTError(-2005270524) // 0x887A0004
	DXGI_ERROR_DEVICE_REMOVED               = HRESULTError(-2005270523) // 0x887A0005
	DXGI_ERROR_DEVICE_HUNG                  = HRESULTError(-2005270522) // 0x887A0006
	DXGI_ERROR_DEVICE_RESET                 = HRESULTError(-2005270521) // 0x887A0007
	DXGI_ERROR_WAS_STILL_DRAWING            = HRESULTError(-2005270518) // 0x887A000A
	DXGI_ERROR_FRAME_STATISTICS_DISJOINT    = HRESULTError(-2005270517) // 0x887A000B
	DXGI_ERROR_GRAPHICS_VIDPN_SOURCE_IN_USE = HRESULTError(-2005270516) // 0x887A000C
	DXGI_ERROR_DRIVER_INTERNAL_ERROR        = HRESULTError(-2005270496) // 0x887A0020
	DXGI_ERROR_NONEXCLUSIVE                 = HRESULTError(-2005270495) // 0x887A0021
	DXGI_ERROR_NOT_CURRENTLY_AVAILABLE      = HRESULTError(-2005270494) // 0x887A0022
	DXGI_ERROR_REMOTE_CLIENT_DISCONNECTED   = HRESULTError(-2005270493) // 0x887A0023
	DXGI_ERROR_REMOTE_OUTOFMEMORY           = HRESULTError(-2005270492) // 0x887A0024
	DXGI_ERROR_ACCESS_LOST                  = HRESULTError(-2005270490) // 0x887A0026
	DXGI_ERROR_WAIT_TIMEOUT                 = HRESULTError(-2005270489) // 0x887A0027
	DXGI_ERROR_SESSION_DISCONNECTED         = HRESULTError(-2005270488) // 0x887A0028
	DXGI_ERROR_RESTRICT_TO_OUTPUT_STALE     = HRESULTError(-2005270487) // 0x887A0029
	DXGI_ERROR_CANNOT_PROTECT_CONTENT       = HRESULTError(-2005270486) // 0x887A002A
	DXGI_ERROR_ACCESS_DENIED                = HRESULTError(-2005270485) // 0x887A002B
	DXGI_ERROR_NAME_ALREADY_EXISTS          = HRESULTError(-2005270484) // 0x887A002C
	DXGI_ERROR_SDK_COMPONENT_MISSING        = HRESULTError(-2005270483) // 0x887A002D
	DXGI_ERROR_NOT_CURRENT                  = HRESULTError(-2005270482) // 0x887A002E
	DXGI_ERROR_HW_PROTECTION_OUTOFMEMORY    = HRESULTError(-2005270480) // 0x887A0030
	DXGI_ERROR_DYNAMIC_CODE_POLICY_VIOLATION= HRESULTError(-2005270479) // 0x887A0031
	DXGI_ERROR_NON_COMPOSITED_UI            = HRESULTError(-2005270478) // 0x887A0032

	// D3D12 specific errors
	D3D12_ERROR_ADAPTER_NOT_FOUND              = HRESULTError(-2005008383) // 0x887E0001
	D3D12_ERROR_DRIVER_VERSION_MISMATCH        = HRESULTError(-2005008382) // 0x887E0002
	D3D12_ERROR_INVALID_REDIST                 = HRESULTError(-2005008381) // 0x887E0003

	// D3D errors (shared with D3D11)
	D3D_ERROR_FILE_NOT_FOUND           = HRESULTError(-2005336062) // 0x88790002
	D3D_ERROR_TOO_MANY_UNIQUE_STATE_OBJECTS = HRESULTError(-2005336063) // 0x88790001
)

// hresultNames maps HRESULT codes to human-readable names.
var hresultNames = map[HRESULTError]string{
	S_OK:    "S_OK",
	S_FALSE: "S_FALSE",

	E_UNEXPECTED:   "E_UNEXPECTED",
	E_NOTIMPL:      "E_NOTIMPL",
	E_OUTOFMEMORY:  "E_OUTOFMEMORY",
	E_INVALIDARG:   "E_INVALIDARG",
	E_NOINTERFACE:  "E_NOINTERFACE",
	E_POINTER:      "E_POINTER",
	E_HANDLE:       "E_HANDLE",
	E_ABORT:        "E_ABORT",
	E_FAIL:         "E_FAIL",
	E_ACCESSDENIED: "E_ACCESSDENIED",

	DXGI_ERROR_INVALID_CALL:                 "DXGI_ERROR_INVALID_CALL",
	DXGI_ERROR_NOT_FOUND:                    "DXGI_ERROR_NOT_FOUND",
	DXGI_ERROR_MORE_DATA:                    "DXGI_ERROR_MORE_DATA",
	DXGI_ERROR_UNSUPPORTED:                  "DXGI_ERROR_UNSUPPORTED",
	DXGI_ERROR_DEVICE_REMOVED:               "DXGI_ERROR_DEVICE_REMOVED",
	DXGI_ERROR_DEVICE_HUNG:                  "DXGI_ERROR_DEVICE_HUNG",
	DXGI_ERROR_DEVICE_RESET:                 "DXGI_ERROR_DEVICE_RESET",
	DXGI_ERROR_WAS_STILL_DRAWING:            "DXGI_ERROR_WAS_STILL_DRAWING",
	DXGI_ERROR_FRAME_STATISTICS_DISJOINT:    "DXGI_ERROR_FRAME_STATISTICS_DISJOINT",
	DXGI_ERROR_GRAPHICS_VIDPN_SOURCE_IN_USE: "DXGI_ERROR_GRAPHICS_VIDPN_SOURCE_IN_USE",
	DXGI_ERROR_DRIVER_INTERNAL_ERROR:        "DXGI_ERROR_DRIVER_INTERNAL_ERROR",
	DXGI_ERROR_NONEXCLUSIVE:                 "DXGI_ERROR_NONEXCLUSIVE",
	DXGI_ERROR_NOT_CURRENTLY_AVAILABLE:      "DXGI_ERROR_NOT_CURRENTLY_AVAILABLE",
	DXGI_ERROR_REMOTE_CLIENT_DISCONNECTED:   "DXGI_ERROR_REMOTE_CLIENT_DISCONNECTED",
	DXGI_ERROR_REMOTE_OUTOFMEMORY:           "DXGI_ERROR_REMOTE_OUTOFMEMORY",
	DXGI_ERROR_ACCESS_LOST:                  "DXGI_ERROR_ACCESS_LOST",
	DXGI_ERROR_WAIT_TIMEOUT:                 "DXGI_ERROR_WAIT_TIMEOUT",
	DXGI_ERROR_SESSION_DISCONNECTED:         "DXGI_ERROR_SESSION_DISCONNECTED",
	DXGI_ERROR_RESTRICT_TO_OUTPUT_STALE:     "DXGI_ERROR_RESTRICT_TO_OUTPUT_STALE",
	DXGI_ERROR_CANNOT_PROTECT_CONTENT:       "DXGI_ERROR_CANNOT_PROTECT_CONTENT",
	DXGI_ERROR_ACCESS_DENIED:                "DXGI_ERROR_ACCESS_DENIED",
	DXGI_ERROR_NAME_ALREADY_EXISTS:          "DXGI_ERROR_NAME_ALREADY_EXISTS",
	DXGI_ERROR_SDK_COMPONENT_MISSING:        "DXGI_ERROR_SDK_COMPONENT_MISSING",
	DXGI_ERROR_NOT_CURRENT:                  "DXGI_ERROR_NOT_CURRENT",
	DXGI_ERROR_HW_PROTECTION_OUTOFMEMORY:    "DXGI_ERROR_HW_PROTECTION_OUTOFMEMORY",
	DXGI_ERROR_DYNAMIC_CODE_POLICY_VIOLATION:"DXGI_ERROR_DYNAMIC_CODE_POLICY_VIOLATION",
	DXGI_ERROR_NON_COMPOSITED_UI:            "DXGI_ERROR_NON_COMPOSITED_UI",

	D3D12_ERROR_ADAPTER_NOT_FOUND:       "D3D12_ERROR_ADAPTER_NOT_FOUND",
	D3D12_ERROR_DRIVER_VERSION_MISMATCH: "D3D12_ERROR_DRIVER_VERSION_MISMATCH",
	D3D12_ERROR_INVALID_REDIST:          "D3D12_ERROR_INVALID_REDIST",

	D3D_ERROR_FILE_NOT_FOUND:                "D3D_ERROR_FILE_NOT_FOUND",
	D3D_ERROR_TOO_MANY_UNIQUE_STATE_OBJECTS: "D3D_ERROR_TOO_MANY_UNIQUE_STATE_OBJECTS",
}
